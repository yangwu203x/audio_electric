<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="title" content="音特"/>
    <meta name="keywords" content="音特，音特电子，话筒"/>
    <meta name="description" content="音特电子，话筒"/>
    <title>音特电子登录</title>
    <link rel="stylesheet" th:href="@{/plugins/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/iconfont.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/intlTelInput.css}">
    <link rel="stylesheet" th:href="@{/css/app.css}" type="text/css">
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="wrapper">
    <!-- 通用头部-->
    <header class="header" th:include="/public/_header"></header>
    <div class="login_content">
        <div class="login" id="login">
            <!--login-->
                <div class="login_form" id="login_form" style="">
                    <p class="login_t">账号登录</p>
                    <div class="form-group">
                        <input class="form-control" id="login_num" placeholder="用户名/邮箱" value="">
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-control" id="login_pwd" placeholder="密码" value="">
                    </div>
                    <div class="form-links clearfix">
                        <a class="yellowColor pull-left" href="javascript:void(0);" onclick="showRegEmail();">注册</a>
                        <a class="yellowColor pull-right" href="javascript:void(0);" onclick="showRegEmail();">忘记密码？</a>
                    </div>
                    <button id="log_submit" type="button" class="btn-red" onclick="login()">登录</button>
                    <div class="form-group">
                        <p class="other_t">其他登录方式</p>
                    </div>
                    <div class="text-center">
                        <a class="login_other" href="#"><i class="iconfont icon-qq"></i></a>
                        <a class="login_other" href="#"><i class="iconfont icon-weixin1"></i></a>
                        <a class="login_other" href="#"><i class="iconfont icon-weibo1"></i></a>
                    </div>
                </div>

            <!--reg_phone-->
            <!--<div class="regPhone_form" id="regPhone_form" >-->
                <!--<p class="login_t">手机注册</p>-->
                <!--<div class="form-group">-->
                    <!--<input id="mobile-number" class="form-control mobile-number" type="tel" placeholder="手机号码">-->
                    <!--<p id="error-msg" class="hide">号码格式不正确</p>-->
                <!--</div>-->
                <!--<div class="form-group input-group">-->
                    <!--<input type="text" class="form-control" placeholder="验证码" id="codeMsg">-->
                    <!--<span class="input-group-btn"><button class="btn btn-yz" type="button" id="sendCode" onclick="sends.send();">获取验证码</button></span>-->
                <!--</div>-->
                <!--<button type="button" class="btn-red">下一步</button>-->
                <!--<div class="form-links form-group clearfix">-->
                    <!--<a class="yellowColor pull-left" href="javascript:void(0);" onclick="showLogin();">登录</a>-->
                    <!--<a class="yellowColor pull-right" href="javascript:void(0);" onclick="showRegEmail();">邮箱注册</a>-->
                <!--</div>-->
            <!--</div>-->
            <!--regEmail_form-->
            <div class="regEmail_form" id="regEmail_form" style="display: none;" data-toggle="validator">
                <p class="login_t">邮箱注册</p>
                <div class="form-group">
                    <input id="reg_email" class="form-control" placeholder="邮箱账号">
                </div>
                <div class="form-group input-group">
                    <input type="text" class="form-control" placeholder="验证码" id="codeMsgEmail">
                    <span class="input-group-btn"><button class="btn btn-yz" type="button" id="sendCodeEmail" onclick="getCode()">获取验证码</button></span>
                </div>
                <button type="button" class="btn-red" onclick="checkCode()">下一步</button>
                <div class="form-p form-group clearfix">
                    <a class="yellowColor pull-left" href="javascript:void(0);" onclick="showLogin();">登录</a>
                </div>
            </div>
            <!--pwd_form-->
            <div class="pwd_form" id="pwd_form" style="display: none;" data-toggle="validator">
                <p class="login_t">输入密码</p>
                <div class="form-group has-feedback">
                    <input  class="form-control" type="password" placeholder="请输入密码(6-16位字母和数字组合)" id="pwd" data-minlength="6" data-maxlength="16" data-delay="500" data-error="密码输入不正确" data-required-error="密码不能为空" required>
                    <span class="iconfont form-control-feedback" aria-hidden="true"></span>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="form-group has-feedback">
                    <input class="form-control" type="password" placeholder="请再次确认密码" id="rePwd" data-match="#pwd" data-error="两次密码不一致" data-required-error="密码不能为空" required>
                    <span class="iconfont form-control-feedback" aria-hidden="true"></span>
                    <div class="help-block with-errors"></div>
                </div>
                <button type="button" class="btn-red" onclick="register()">完成</button>
            </div>
        </div>

    </div>
    <footer class="login_footer" th:include="/public/_footer"></footer>
</div>

<script type="text/javascript" th:src="@{/plugins/jquery/js/jquery-2.1.3.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/jquery/js/jquery-migrate-1.4.1.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/js/intlTelInput.js}"></script>
<script type="text/javascript" th:src="@{/js/validator.js}"></script>
<script type="text/javascript" th:src="@{/js/app.js}"></script>
<script type="text/javascript" th:src="@{/js/reg/login.js}"></script>
<script type="text/javascript">
    function login (){
        var username = $("#login_num").val();
        var password = $("#login_pwd").val();
        $.ajax({
            url:'/account/login',
            type:"POST",
            data:{'email':username,"password":password},
            success: function (data) {

                var obj = eval('(' + data + ')');
                if(obj.responseCode == 1)
                    window.location.href="/user/index";
            },
            error:function (error) {
                //弹出错误信息
            }
        })
    };

    // 邮件获取验证码
    function getCode() {
        var email = $("#reg_email").val();
        var validCode = $("#reg_code").val();
        $.ajax({
            url:'/account/sendValidCode',
            type:"POST",
            ContentType: "application/json; charset=utf-8",
            data:{'email':email,"validCode":validCode},
            success: function (data) {
                IsJsonString(data,function(){
                    alert("验证码发送成功！")
                });

            },
            error:function (error) {
                //弹出错误信息
            }
        })
    }

    // 校验验证码
    function checkCode() {
        var email = $("#reg_email").val();
        var validCode = $("#codeMsgEmail").val();

        $.ajax({
            url:'/account/checkValidCode',
            type:"POST",
            dataType: "json",
            data:{'email':email,"validCode":validCode},
            success: function (data) {
                IsJsonString(data,
                    function(){
                    $('#pwd_form').show();
                    $('#regEmail_form').hide();});
            },
            error:function (error) {
                //弹出错误信息
            }
        })
    }


    //注册
    function register(){
        var password = $("#pwd").val();
        var email = $("#reg_email").val();
        $.ajax({
            url:'/account/register',
            type:"POST",
            dataType: "json",
            data:{'password':password,"email":email},
            success: function (data) {
                IsJsonString(data,function(){window.location.href="/user/index";});

            },
            error:function (error) {
                //弹出错误信息
            }
        })
    }

    //判断是不是正确的json格式
    function IsJsonString(data,callback) {
        try {
            var obj = JSON.parse(data);
        } catch (e) {
            if(data.responseCode == 1)
                callback();
            else
                alert(data.resultMessage);
            return ;
        }
        callback();
        return ;
    }
</script>
</body>
</html>