<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="title" content="音特"/>
    <meta name="keywords" content="音特，音特电子，话筒"/>
    <meta name="description" content="音特电子，话筒"/>
    <title>音特电子</title>
    <link rel="stylesheet" th:href="@{/plugins/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/iconfont.css}">
    <link rel="stylesheet" th:href="@{/css/app.css}" type="text/css">
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="wrapper">
    <!-- 通用头部-->
    <header class="header navbar-fixed-top" th:include="/public/_header::header"></header>
    <!-- 内容区-->
    <section class="content">
        <div class="container">
            <!--位置导航-->
            <div class="navAdd">
                <div class="navAdd-block">
                    <a class="navAdd-a" th:href="@{/}">首页</a>
                    <span class="navAdd-dot"></span>
                    <a class="navAdd-a" th:href="@{/user/orders/view}">会员中心</a>
                    <span class="navAdd-dot"></span>
                    <a class="navAdd-a active" href="#">售后服务</a>
                </div>
            </div>
            <!--个人中心-->
            <div class="person">
                <div class="row" th:with="activeState=2">
                    <div class="col-lg-3 col-md-2" th:include="/public/person_data::person_data"></div>
                    <div class="col-lg-9 col-md-10">
                        <div class="myOrder">
                            <div class="orderTitle">
                                <span class="f-24">售后服务</span>
                            </div>
                            <div class="myOrderBlock">
                                <!-- Nav tabs -->
                                <ul class="myOrder-tabs" role="tablist" id="serviceTab">
                                    <li role="presentation" th:class="${serviceActive == '0'} ? 'active':''"><a href="/user/service/view" >全部</a></li>
                                    <li role="presentation" th:class="${serviceActive == '1'} ? 'active':''"><a href="/user/service/view/status/1"  >待审核<!--<span class="badge" th:text="${saleServiceState1}"></span>--></a></li>
                                    <li role="presentation" th:class="${serviceActive == '2'} ? 'active':''"><a href="/user/service/view/status/2"  >已审核<!--<span class="badge" th:text="${saleServiceState2}"></span>--></a></li>
                                    <li role="presentation" th:class="${serviceActive == '3'} ? 'active':''"><a href="/user/service/view/status/3" >正在处理<!--<span class="badge" th:text="${handling}"></span>--></a></li>
                                    <li role="presentation" th:class="${serviceActive == '5'} ? 'active':''"><a href="/user/service/view/status/5" >已完成<!--<span class="badge" th:text="${saleServiceState5}"></span>--></a></li>
                                    <li role="presentation" th:class="${serviceActive == '6'} ? 'active':''"><a href="/user/service/view/status/6" >已关闭<!--<span class="badge" th:text="${saleServiceState6}"></span>--></a></li>
                                </ul>

                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div role="tabpanel" class="tab-pane active" id="allService" th:switch="${saleServices.size() >0}">
                                        <div class="noThisOrder" th:case="false">
                                            <img class="noOrder" th:src="@{/images/noOrder.png}"><p class="noOrder_tips">您还没有相关的售后服务</p><p class="goSee"></p>
                                        </div>
                                        <div class="tableHead" th:case="true">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div>商品</div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div>退款金额（元）</div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div>服务类型</div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div>状态</div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div>交易操作</div>
                                                </div>
                                            </div>
                                        </div>
                                        <ul>
                                            <!--退货待审核-->
                                            <li th:each="saleService:${saleServices}">
                                                <div class="myOrderNum">
                                                    <span class="orderNumber">退货编号：<span class="order_number" th:text="${saleService.id}"></span></span>
                                                    <span >申请时间：<span class="order_time" th:text="${saleService.submitTime}"></span></span>
                                                </div>
                                                <div class="tableContent">
                                                    <div class="myOrderList">
                                                        <div class="row" th:each="trolley:${saleService.orders.trolleys}" th:with="product=${trolley.getProduct()}">
                                                            <div class="col-md-4">
                                                                <div class="goods orderGoods clearfix">
                                                                    <a th:href="'/product/view/id/'+${product.getId()}">
                                                                        <div class="goods-img"><img  th:src="${product.thumbnail3}" alt=""/></div>
                                                                        <p class="goods-name" th:text="${product.categoryName+ ' '+product.name}"></p>
                                                                        <p class="goods-color" th:text="'颜色：'+${product.color}+' '+${trolley.series}"></p>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <div class="myOrderMoney" th:text="'￥'+${product.priceSale}"></div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <div class="myOrderNumber" th:text="${saleService.serviceType}"></div>
                                                            </div>
                                                            <div class="col-md-2" th:switch="${saleService.state}">
                                                                <div class="myOrderState" th:case="1">待审核</div>
                                                                <div class="myOrderState" th:case="2">已审核</div>
                                                                <div class="myOrderState" th:case="3">正在处理</div>
                                                                <div class="myOrderState" th:case="4">正在处理</div>
                                                                <div class="myOrderState" th:case="5">已完成</div>
                                                                <div class="myOrderState" th:case="6">已关闭</div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <div class="doOrder closeOrder" th:switch="${saleService.state}">
                                                                    <!--<input type="hidden" th:value="${saleService.id}" />-->
                                                                    <p><a th:href="'/user/service/view/orderId/'+${saleService.orders.id}">查看进度</a></p>
                                                                    <p th:case="1"><a class="delete_tip_a" th:title="${saleService.id}" href="javascript:void(0)" data-toggle="modal" data-target="#deleteModal">取消服务</a></p>
                                                                    <p th:case="2"><a class="delete_tip_a" th:title="${saleService.id}" href="javascript:void(0)" data-toggle="modal" data-target="#deleteModal">取消服务</a></p>
                                                                    <!--<p th:case="3"><a class="delete_tip_a" th:title="${saleService.id}" href="javascript:void(0)" data-toggle="modal" data-target="#deleteModal">取消服务</a></p>-->
                                                                    <!--<p th:case="4"><a class="delete_tip_a" th:title="${saleService.id}" href="javascript:void(0)" data-toggle="modal" data-target="#deleteModal">取消服务</a></p>-->
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </section>

    <!-- footer-->
    <footer id="footer" th:include="/public/_footer::footer">
    </footer>
</div>
<!-- deleteModal -->
<input type="hidden" id="common_confirm_btn" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#deleteModal">
<div class="modal myInfoModal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <i class="close iconfont icon-close" data-dismiss="modal" aria-label="Close" aria-hidden="true"></i>
            </div>
            <div class="modal-body">
                <h4 class="modal-title deleteModal_t" id="deleteModalLabel">确定取消服务吗?</h4>
                <div class="modal-btns">
                    <div class="row">
                        <div class="col-md-6">
                            <button type="button" class="btn-qx ok" data-dismiss="modal">确定</button>
                        </div>
                        <div class="col-md-6">
                            <button type="button" class="btn-red cancel" data-dismiss="modal">取消</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" th:src="@{/plugins/jquery/js/jquery-2.1.3.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/jquery/js/jquery-migrate-1.4.1.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/js/app.js}"></script>
<script type="text/javascript">
    $('.delete_tip_a').click(function (e) {
        e.stopPropagation();
        var id = $(this).attr("title");
        Common.confirm({
            operate: function (reselt) {
                if (reselt) {
                    $.ajax({url:'/user/service/cancer',data:{id:id},type:'put',success:function(result){
                        if (result.code == 1){
                            alert("取消成功！");
                            window.location.reload();
                        }else if(result.code == 2){
                            window.location.href = result.url;
                        }else{
                            alert(result.msg);
                        }
                    }});
                } else {
                }
            }
        })
    });

    var Common = {
        confirm:function(params){
            var model = $("#deleteModal");
            $("#common_confirm_btn").click();
            //每次都将监听先关闭，防止多次监听发生，确保只有一次监听
            model.find(".cancel").die("click");
            model.find(".ok").die("click");
            model.find(".ok").live("click",function(){
                params.operate(true)
            });

            model.find(".cancel").live("click",function(){
                params.operate(false)
            })
        }
    }

</script>
</body>
</html>